<!doctype html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <a name="section-1"></a>
    <div class="row" id="section-1">
        <div class="col-md-4 col-md-offset-4 vertically-centered">
            <form role="form">
                <div class="form-group">
                    <label for="box-view-token"><h2 id="section-1-heading">Enter a View API Token</h2></label>
                    <input class="form-control input-lg" id="box-view-token" placeholder="View API Token">
                    <span class="help-block"><a href="http://bit.ly/boxapikey" target="_blank">Click here to get a Box View API token</a>.</span>
                </div>
                <a href="#section-2" id="token-button" class="btn btn-default btn-lg btn-block">Next Step...</a>
            </form>
        </div>
    </div>
    <a name="section-2"></a>
    <div class="row" id="section-2">
        <div class="col-md-3 col-md-offset-1 vertically-centered">
            <form role="form">
                <div class="form-group">
                    <label for="document-url"><h2>Enter the URL of a PDF or Office document to convert.</h2></label>
                    <input type="url" class="form-control input-lg" id="document-url" placeholder="URL ending in .pdf, .doc(x), .ppt(x), or .xls(x)">
                    <span class="help-block"><a id="url-help" href="">Help, fill one in for me!</a></span>
                </div>
                <a href="#section-3" id="convert-button" class="btn btn-default btn-lg btn-block">Convert Document</a>
            </form>
        </div>
        <div class="col-md-6 col-md-offset-1 vertically-centered">
            <pre id="convert-code">curl https://view-api.box.com/1/documents \
-H "Authorization: Token YOUR_API_KEY" \
-H "Content-Type: application/json" \
-d '{"url": "https://cloud.box.com/shared/static/4qhegqxubg8ox0uj5ys8.pdf"}' \
-X POST</pre>
            <pre id="convert-result">{
    "type": "document",
    "id": "2da6cf9261824fb0a4fe532f94d14625",
    "status": "done",
    "name": "My First Doc",
    "created_at": "2013-08-30T00:17:37Z",
    "modified_at": "2013-08-30T00:17:37Z"
}</pre>
        </div>
    </div>
    <a name="section-3"></a>
    <div class="row" id="section-3">
        <div class="col-md-3 col-md-offset-1 vertically-centered">
            <form role="form">
                <div class="form-group">
                    <label for="document-url"><h2>Enter the ID of the document to create a viewing session.</h2></label>
                    <input class="form-control input-lg" id="document-id" placeholder="The document id">
                    <span id="document-id-help" class="help-block"></span>
                </div>
                <a href="#section-4" id="session-button" class="btn btn-default btn-lg btn-block">Create Session</a>
            </form>
        </div>
        <div class="col-md-6 col-md-offset-1 vertically-centered">
            <pre>curl https://view-api.box.com/1/sessions \
-H "Authorization: Token YOUR_API_KEY" \
-H "Content-Type: application/json" \
-d '{"document_id": "ABC123"}' \
-X POST</pre>
        </div>
    </div>
    <a name="section-4"></a>
    <div class="row" id="section-4">
        <div class="col-md-3 col-md-offset-1 vertically-centered">
            <h1>Congratulations, you converted your first document!</h1>
        </div>
        <div class="col-md-8">
            <div id="contentframe"><iframe seamless=""></iframe></div>
        </div>
    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='typed.js') }}"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0/js/bootstrap.min.js
"></script>
    <script>
        $('#url-help').click(function() {
            var url = "https://cloud.box.com/shared/static/4qhegqxubg8ox0uj5ys8.pdf";
            $('#document-url').val(url);
            return false;
        });

        // Put the API token on #token-button
        $('#token-button').click(function() {
            var boxViewToken = $('#box-view-token').val();
            $(this).attr('data-box-view-token', boxViewToken)
            $('#section-1-heading').fadeOut('slow', function() {
                $(this).text('Verified âœ“').fadeIn('fast');
            });
            var href = $(this).attr('href')
            $('html,body').delay(1200).animate({scrollTop: $(href).offset().top},'slow');
            return false;
        });

        // Send the URL to Box View for conversion
        $('#convert-button').click(function() {

            var requestFadeInTime = 400;
            var responseFadeInTime = 400;


            var documentURL = $('#document-url').val();
            console.log(documentURL);
            var data = JSON.stringify({
                box_view_token: $('#token-button').attr('data-box-view-token'),
                url: documentURL
            });
            $('#convert-code').fadeIn();
            $('#convert-result').delay(requestFadeInTime).fadeIn();
            $.ajax({
                type: 'POST',
                contentType: 'application/json',
                data: data,
                dataType: 'json',
                url: '/upload',

            }).always(function(data) {
                $('#document-id-help').text("Hint, it's: " + data.responseText);
                console.log(data);
            });
            var href = $(this).attr('href')
            $('html,body').delay(requestFadeInTime + responseFadeInTime + 400).animate({scrollTop: $(href).offset().top},'slow');
            return false;
        });

        // Creates a session for the document ID
        $('#session-button').click(function() {
            var documentID = $('#document-id').val();
            var data = JSON.stringify({
                box_view_token: $('#token-button').attr('data-box-view-token'),
                document_id: documentID
            });
            $.ajax({
                type: 'POST',
                contentType: 'application/json',
                data: data,
                dataType: 'json',
                url: '/session',

            }).always(function(data) {
                $('iframe').attr('src', data.responseText).fadeIn(1000);
                console.log(data);
            });
            var href = $(this).attr('href')
            $('html,body').delay(800).animate({scrollTop: $(href).offset().top},'slow');
            return false;
        });
    </script>
</body>
</html>